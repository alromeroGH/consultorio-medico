<div class="container py-4">
  <button
  mat-icon-button
  (click)="volverAtras()"
  class="back-button"
  title="Volver al inicio"
>
  <mat-icon>arrow_back</mat-icon>
</button>
  <div class="row justify-content-center">
    <div class="col-md-8">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Asignaci√≥n de Turnos (Operador)</mat-card-title>
          <mat-card-subtitle>Seleccione paciente, especialidad, profesional y horario.</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="form" (ngSubmit)="confirmarTurno()">

            <!-- üõë CAMBIO CLAVE: SELECT DE PACIENTES -->
            <mat-form-field class="full-width">
              <mat-label>Paciente a Asignar</mat-label>
              <mat-select formControlName="id_paciente">
                <mat-option *ngFor="let paciente of pacientes" [value]="paciente.id">
                  {{ paciente.apellido }}, {{ paciente.nombre }} (DNI: {{ paciente.dni }})
                </mat-option>
              </mat-select>
              <mat-error *ngIf="form.get('id_paciente')?.hasError('required')">El paciente es obligatorio.</mat-error>
            </mat-form-field>

            <hr>

            <!-- 1. SELECCI√ìN DE ESPECIALIDAD -->
            <mat-form-field class="full-width">
              <mat-label>Especialidad</mat-label>
              <mat-select formControlName="especialidad">
                <mat-option *ngFor="let esp of especialidades" [value]="esp.id">
                  {{ esp.descripcion }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="form.get('especialidad')?.hasError('required')">La especialidad es obligatoria.</mat-error>
            </mat-form-field>

            <!-- 2. SELECCI√ìN DE PROFESIONAL -->
            <mat-form-field class="full-width">
              <mat-label>Profesional</mat-label>
             <mat-select formControlName="profesional">
            <mat-option
              *ngFor="let medico of medicos"
              [value]="medico.id_medico"
            >
              {{ medico.nombre }} {{ medico.apellido }}
            </mat-option>
          </mat-select>
              <mat-error *ngIf="form.get('profesional')?.hasError('required')">El profesional es obligatorio.</mat-error>
              <mat-hint *ngIf="form.get('profesional')?.disabled">Seleccione una especialidad primero.</mat-hint>
            </mat-form-field>

            <div class="row">
              <div class="col-md-6">
                <!-- 3. SELECCI√ìN DE FECHA -->
                <mat-form-field class="full-width">
                  <mat-label>Fecha</mat-label>
                  <input matInput [matDatepicker]="picker" formControlName="fecha" [min]="minDate">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                  <mat-error *ngIf="form.get('fecha')?.hasError('required')">La fecha es obligatoria.</mat-error>
                  <mat-hint *ngIf="form.get('fecha')?.disabled">Seleccione un profesional primero.</mat-hint>
                </mat-form-field>
              </div>
              <div class="col-md-6">
                <!-- 4. SELECCI√ìN DE HORA -->
                <mat-form-field class="full-width">
                  <mat-label>Horario Disponible</mat-label>
                  <mat-select formControlName="hora">
                    <mat-option *ngFor="let horario of horariosDisponibles" [value]="horario">
                      {{ horario.hora }}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="form.get('hora')?.hasError('required')">La hora es obligatoria.</mat-error>
                  <mat-hint *ngIf="horariosDisponibles.length === 0 && form.get('fecha')?.valid">No hay horarios disponibles.</mat-hint>
                </mat-form-field>
              </div>
            </div>

            <!-- 5. NOTA/MOTIVO DE CONSULTA -->
            <mat-form-field class="full-width">
              <mat-label>Nota de Turno</mat-label>
              <textarea matInput formControlName="notas" rows="3"></textarea>
              <mat-error *ngIf="form.get('notas')?.hasError('required')">La nota es obligatoria.</mat-error>
            </mat-form-field>

            <div class="text-center">
              <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
                Asignar y Confirmar Turno
              </button>
              <button mat-button type="button" (click)="cancelar()" class="ms-2">
                Cancelar
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
